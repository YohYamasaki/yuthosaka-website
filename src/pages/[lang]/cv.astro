---
import type { BaseHeadProps } from "../../components/BaseHead.astro";
import BaseSite from "../../layouts/BaseSite.astro";
import CvIntro from "../../components/CvIntro.astro";
import { type CollectionEntry, getCollection } from "astro:content";
import TabContainer from "../../components/TabContainer.astro";
import { langParams } from "../../i18n/ui";

const baseHeadProps: BaseHeadProps = {
  title: "CV",
};

export async function getStaticPaths() {
  return langParams;
}

const { lang } = Astro.params;

const cvContents: CollectionEntry<"cv">[] = await getCollection("cv", (entry) =>
  entry.id.startsWith(lang),
);

const cvData = await Promise.all(cvContents.map((c) => c.render()));

cvData.sort(
  (a, b) => a.remarkPluginFrontmatter.order - b.remarkPluginFrontmatter.order,
);
---

<BaseSite {...baseHeadProps}>
  <CvIntro />
  {
    cvData.map((data) => (
      <TabContainer
        id={data.remarkPluginFrontmatter.title}
        title={data.remarkPluginFrontmatter.title}
      >
        <data.Content />
      </TabContainer>
    ))
  }
</BaseSite>
